{% extends "layout.html" %}

{% block title %}Add Product{% endblock %}

{% block content %}
	<div class="container m-t-50">
		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<form role="form" method="POST" action="" enctype="multipart/form-data">
                {{ form.csrf_token }}
				<div class="form-group">
                    {% if form.title.errors %}
                        {% for error in form.title.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endif %}
					{{ form.title(class_="form-control", placeholder=form.title.label.text) }}
				</div>
				<div class="form-group">
                    {% if form.description.errors %}
                        {% for error in form.description.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endif %}
					{{ form.description(class="form-control", id="word_count", row="5",
					placeholder=form.description.label.text) }}
                    <p>Total word count: <span id="display_count">0</span> words. Words left:
                        <span id="word_left">50</span>
                    </p>
				</div>
                <div class="form-group">
                    {% if form.discount_price.errors %}
                        {% for error in form.discount_price.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endif %}
					{{ form.discount_price(class_="form-control", placeholder=form.discount_price.label.text) }}
				</div>
                <div class="form-group">
                    {% if form.regular_price.errors %}
                        {% for error in form.regular_price.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endif %}
					{{ form.regular_price(class_="form-control", placeholder=form.regular_price.label.text) }}
				</div>
                <div class="form-group">
                    {% if form.product_url.errors %}
                        {% for error in form.product_url.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endif %}
					{{ form.product_url(class_="form-control", placeholder=form.product_url.label.text) }}
				</div>
                <div class="img-prev-blog">
                    <img src="#" id="preview_image">
                </div>
                <div class="form-group">
                    {% if form.image_name.errors %}
                        {% for error in form.image_name.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                    <label for="featureImage">Feature Image</label>
                    <div id="featureImage">
                        {{ form.image_name(class_="form-control", id="input_file") }}
                    </div>
                </div>
                <div class="form-group">
					{{ form.submit(class_="btn btn-default") }}
				</div>
			</form>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="True">Ã—</span></button>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
		</div>
	</div>
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function() {
          $("#word_count").on('keyup', function() {
            var words = this.value.match(/\S+/g).length;

            if (words > 50) {
              // Split the string on first 200 words and rejoin on spaces
              var trimmed = $(this).val().split(/\s+/, 50).join(" ");
              // Add a space at the end to make sure more typing creates new words
              $(this).val(trimmed + " ");
            }
            else {
              $('#display_count').text(words);
              $('#word_left').text(50-words);
            }
          });
        });
        function readURL(input) {

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#preview_image').attr('src', e.target.result);
                };

                reader.readAsDataURL(input.files[0]);
            }
            else {
                $('#preview_image').attr('src', '#');
            }
        }

        $("#input_file").change(function(){
            readURL(this);
        });
    </script>
{% endblock %}